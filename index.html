<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <title>Rastgele Benzer Haberler...</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.103.0.min.js"></script>
    <style>
    body {
      font-size: 16px;
    }
    
    h1 {
      font-size: 50px;
    }
    
    
    
    
  </style>
    

</head>

<body>

    <div id="data"></div>

    <script>
        var randomNum   = 0;
        var index_news  = 0;
        var index_no    = 0;
        
        const dataDisplay = document.getElementById("data");
         $("#data").append("<p><h2>" + "HABERLER BEKLENİYOR " + "</h2></p>");


         const getData = (() => {
         let data = null;
          
         return async () => {
            if (!data) {
              const response = await fetch('https://m8myq3vscc.execute-api.us-east-1.amazonaws.com/analyze_news/daily_news');
              data = await response.json();
            }
            
            return data;
          }
        })();
        
        
        
        
        let generatedIntegers = [];

        function getRandomIntInRange(min, max) {
          let randomInt = Math.floor(Math.random() * (max - min + 1)) + min;
          
          while (generatedIntegers.includes(randomInt)) {
            randomInt = Math.floor(Math.random() * (max - min + 1)) + min;
          }
          
          generatedIntegers.push(randomInt);
          return randomInt;
        }
        
        
        
        
        
        function displayData(index_no){
            // clear previous data
           dataDisplay.innerHTML = "";
        
           $.each(myData, function(key, value) {
               if (key == "cluster" + index_no) {

                   $.each(value, function(innerkey, innervalue) {

                       if (innerkey == "picture") {
                           $("#data").append("<p>" + " " + "</p>");
                           $("#data").append("<img src=" + innervalue + " width='500' height='300' style='float: left; margin-left: 120px;'/>");
                           $("#data").append("<p>" + " " + "</p>");
                           $("#data").append("<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>");
                          
                           
                       };

                       if (innerkey == "main") {
                           //$("#data").append("<h3>" + innervalue + "</h3>");
                           //$("#data").append("<p>" +" " + "</p>");
                       };

                       if (innerkey == "info") {
                           $.each(innervalue, function(innerInnerkey, innerInnervalue) {
                               $("#data").append("<h4>" + innerInnervalue.title + " ------ " + "<a href=" + innerInnervalue.link + " target='_blank'>" + innerInnervalue.source + "</a>" + "</h4>")
                               //$("#data").append("<a href="  +innerInnervalue.link +" target='_blank'>" + innerInnervalue.source +"</a>");
                               $("#data").append("<p>" + " " + "</p>");

                           });
                       };
                       $("#data").append("<br></br>");

                   });

               };
           });
        
        
        };  
        
        
        let myData;
        getData().then((data) => {
          myData = data;
          if (myData) {
            var lengtofdata = Object.keys(myData).length;
          
          
            console.log(myData); 
            dataDisplay.innerHTML = "";
            $("#data").append("<p><h1>" + "HAZIR... " + "</h1></p>");
            $("#data").append("<p><h2>" + "Ekranınızın sağ tarafına tıklayarak ileri" + "</h2></p>");
            $("#data").append("<p><h2>" + "Sol tarafına tıklayarak geri gidebilirsiniz" + "</h2></p>");
            
            
            
            
            
            
            document.addEventListener("click", function(event) {
              var windowWidth = window.innerWidth;
              var clickX = event.clientX;
              
              if (clickX > windowWidth / 2) {
              
              
                index_no =    index_news;
                
                displayData(index_no);

                index_news = index_news + 1;
                
                if (index_news == lengtofdata){
                    index_news =0;
                    };

              }
              else{
              
              if (index_news>=0){
                  index_no =    index_news-2;
                  
                  displayData(index_no);

                  index_news = index_news - 1;
                  
                  if (index_news == lengtofdata){
                      index_news =0;
                      };
              };
              
              
              }
            });

            
            
            /*
            //var button_random = document.querySelector('#button_random');
            myButton_random.addEventListener('click', function() {  
                    
                    randomNum = getRandomIntInRange(0, lengtofdata);
                    
                    index_no =    randomNum;
                    
                    displayData(index_no);

            });
            */
          } else {
            console.log("Data hasn't been fetched yet");
          }
        });
        
        

        
        
        
       
        
        
        

       
    </script>
</body>

</html>
